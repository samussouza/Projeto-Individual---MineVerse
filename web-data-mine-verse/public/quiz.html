<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz</title>
    <link rel="stylesheet" href="./css/quiz.css">
</head>

<body>
    <video autoplay muted loop id="video-bg">
        <source src="BackgroundVideoMine.mp4" type="video/mp4">
        Seu navegador não suporta vídeos HTML5.
    </video>
    <div class="quiz-container">

        <div class="div-quiz">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h2>
            <hr>
            <p>1. Quem criou o Minecraft?</p>


            <input type="radio" id="opcao1a" name="resposta1" value="Markus Persson">
            <label for="opcao1a">Markus Persson</label><br>

            <input type="radio" id="opcao1b" name="resposta1" value="Linus Torvalds">
            <label for="opcao1b">Linus Torvalds</label><br>

            <input type="radio" id="opcao1c" name="resposta1" value="Rasmus Lerdorf">
            <label for="opcao1c">Rasmus Lerdorf</label><br>

            <button style="margin-left: 420px;" onclick="proximaPergunta(2)">Next</button>

        </div>


        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h2>
            <hr>
            <p>2. Qual era o nome original do Minecraft?</p>

            <input type="radio" id="opcao2a" name="resposta2" value="Cave Game">
            <label for="opcao2a">Cave Game</label><br>

            <input type="radio" id="opcao2b" name="resposta2" value="Brickcraft">
            <label for="opcao2b">Brickcraft</label><br>

            <input type="radio" id="opcao2c" name="resposta2" value="MineBlocks">
            <label for="opcao2c">MineBlocks</label><br>

            <button style="margin-left: 420px;" onclick="proximaPergunta(3)">Avançar</button>
            <button style="margin-left: 20px;" onclick="perguntaAnterior(2)">Voltar</button>
        </div>


        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h1>
                <hr>
                <p>3. Quais sÃo os trÊs tipos de dimensÕes acessÍveis no jogo?</p>

                <input type="radio" id="opcao3a" name="resposta3" value="The End, The Nether, Overworld">
                <label for="opcao3a">The End, The Nether, Overworld</label><br>

                <input type="radio" id="opcao3b" name="resposta3" value="Aether, Overworld, Nether">
                <label for="opcao3b">Aether, Overworld, Nether</label><br>

                <input type="radio" id="opcao3c" name="resposta3" value="The Void, The Nether, Overworld">
                <label for="opcao3c">The Void, The Nether, Overworld</label><br>

                <button style="margin-left: 420px;" onclick="proximaPergunta(4)">Next</button>
                <button style="margin-left: 20px;" onclick="perguntaAnterior(2)">Voltar</button>
        </div>

        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h1>
                <hr>
                <p>4. Qual É a criatura hostil e perigosa em Minecraft?</p>

                <input type="radio" id="opcao4a" name="resposta4" value="Enderman">
                <label for="opcao4a">Enderman</label><br>

                <input type="radio" id="opcao4b" name="resposta4" value="Enderdragon">
                <label for="opcao4b">Enderdragon</label><br>

                <input type="radio" id="opcao4c" name="resposta4" value="Wither">
                <label for="opcao4c">Wither</label><br>

                <button style="margin-left: 420px;" onclick="proximaPergunta(5)">Next</button>
                <button style="margin-left: 20px;" onclick="perguntaAnterior(3)">Voltar</button>
        </div>

        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h1>
                <hr>
                <p>5. Qual É o nome do dragÃo que reside no The End?</p>

                <input type="radio" id="opcao5a" name="resposta5" value="Enderdragon">
                <label for="opcao5a">Enderdragon</label><br>

                <input type="radio" id="opcao5b" name="resposta5" value="Enderlord">
                <label for="opcao5b">Enderlord</label><br>

                <input type="radio" id="opcao5c" name="resposta5" value="Dragão das Sombras">

                <label for="opcao5c">Dragão das Sombras</label><br>
                <button style="margin-left: 20px;" onclick="perguntaAnterior(4)">Voltar</button>
                <button style="margin-left: 420px;" onclick="proximaPergunta(6)">Next</button>
        </div>
        <!--Rever-->
        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h1>
                <hr>
                <p>6.Quais sÃo os ingredientes necessÁrios para criar um portal para o Nether?</p>

                <input type="radio" id="opcao6a" name="resposta6" value="Obsidiana">
                <label for="opcao6a">Obsidiana</label><br>

                <input type="radio" id="opcao6b" name="resposta6" value="Flint and Steel">
                <label for="opcao6b">Flint and Steel</label><br>

                <input type="radio" id="opcao6c" name="resposta6" value="Ghast Tear">
                <label for="opcao6c">Ghast Tear</label><br>
                <button style="margin-left: 20px;" onclick="perguntaAnterior(5)">Voltar</button>
                <button style="margin-left: 420px;" onclick="proximaPergunta(7)">Next</button>
        </div>

        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h1>
                <hr>
                <p>7. Como se chama o mob que explode quando se aproxima do jogador?</p>

                <input type="radio" id="opcao7a" name="resposta7" value="Creeper">
                <label for="opcao7a">Creeper</label><br>

                <input type="radio" id="opcao7b" name="resposta7" value="Ghast">
                <label for="opcao7b">Ghast</label><br>

                <input type="radio" id="opcao7c" name="resposta7" value="TNT">
                <label for="opcao7c">TNT</label><br>
                <button style="margin-left: 20px;" onclick="perguntaAnterior(6)">Voltar</button>
                <button style="margin-left: 420px;" onclick="proximaPergunta(8)">Next</button>
        </div>

        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h1>
                <hr>
                <p>8. Qual destes é um ingrediente necessário para fazer uma poção de invisibilidade em Minecraft?</p>

                <input type="radio" id="opcao8a" name="resposta8" value="Olho de aranha">
                <label for="opcao8a">Olho de aranha</label><br>

                <input type="radio" id="opcao8b" name="resposta8" value="Pó de blaze">
                <label for="opcao8b">Pó de blaze</label><br>

                <input type="radio" id="opcao8c" name="resposta8" value="Cenoura dourada">
                <label for="opcao8c">Cenoura dourada</label><br>
                <button style="margin-left: 20px;" onclick="perguntaAnterior(7)">Voltar</button>
                <button style="margin-left: 420px;" onclick="proximaPergunta(9)">Next</button>
        </div>

        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h2>
            <hr>
            <p>9. Qual é a única ferramenta em Minecraft que pode colher recursos de qualquer tipo de minério?</p>

            <input type="radio" id="opcao9a" name="resposta9" value="Pá de Diamante com Fortuna">
            <label for="opcao9a">Pá de Diamante com Fortuna</label><br>

            <input type="radio" id="opcao9b" name="resposta9" value="Pico de Ferro com Eficiência">
            <label for="opcao9b">Pico de Ferro com Eficiência</label><br>

            <input type="radio" id="opcao9c" name="resposta9" value="Pico de Diamante com Toque de Seda">
            <label for="opcao9c">Pico de Diamante com Toque de Seda</label><br>
            <button style="margin-left: 20px;" onclick="perguntaAnterior(8)">Voltar</button>
            <button style="margin-left: 420px;" onclick="proximaPergunta(10)">Next</button>
        </div>


        <div class="div-quiz" style="display: none;">
            <h2 style="font-family: Arial, sans-serif; font-weight: 900;">CraftQuiz</h2>
            <hr>
            <p>10. Qual é a relação entre a altura do Nether e do Overworld em Minecraft?</p>

            <input type="radio" id="opcao10a" name="resposta10" value="A altura do Nether é a mesma do Overworld">
            <label for="opcao10a">Nether é igual ao Overworld</label><br>

            <input type="radio" id="opcao10b" name="resposta10" value="O Nether é duas vezes mais alto que o Overworld">
            <label for="opcao10b">Nether é duas vezes mais alto que o Overworld</label><br>

            <input type="radio" id="opcao10c" name="resposta10"
                value="8 blocos Nether equivalem a 64 blocoss no Overworld">
            <label for="opcao10c">8 blocos Nether equivalem a 64 blocoss no Overworld</label><br>
            <button style="margin-left: 20px;" onclick="perguntaAnterior(9)">Voltar</button>
            <button style="margin-left: 420px;" onclick="enviarRespostas()">Enviar</button>
        </div>
    </div>


</body>

</html>


<script>
    function validarRespostas() {
        var perguntas = document.querySelectorAll('.div-quiz');

        for (var validacao = 0; validacao < perguntas.length; validacao++) {
            /*verifica se tem pelo menos um input selecionda por div*/
            var inputs = perguntas[validacao].querySelectorAll('input[type="radio"]:checked');
            if (inputs.length == 0) {
                alert("Por favor, responda todas as perguntas antes de prosseguir.");
                return false;
            }
        }

        return true;
    }
    /*utilizei o metodo de argumento na funcao vinda do onclick*/
    function perguntaAnterior(atual) {
        var perguntas = document.querySelectorAll('.div-quiz');

        for (var contador = 0; contador < perguntas.length; contador++) {
            if (contador === atual - 2) {
                perguntas[contador].style.display = 'block';
            } else {
                perguntas[contador].style.display = 'none';
            }
        }
    }


    function proximaPergunta(proxima) {
        var perguntas = document.querySelectorAll('.div-quiz');

        for (var contador = 0; contador < perguntas.length; contador++) {
            if (contador + 1 == proxima) {
                perguntas[contador].style.display = 'block';
            } else {
                perguntas[contador].style.display = 'none';
            }
        }

    }


    function enviarRespostas() {

        if (!validarRespostas()) {
            return;
        }
        /*Obtem os valores selecionados, que serão enviados para o banco*/
        const resposta1 = document.querySelector('input[name="resposta1"]:checked').value;
        const resposta2 = document.querySelector('input[name="resposta2"]:checked').value;
        const resposta3 = document.querySelector('input[name="resposta3"]:checked').value;
        const resposta4 = document.querySelector('input[name="resposta4"]:checked').value;
        const resposta5 = document.querySelector('input[name="resposta5"]:checked').value;
        const resposta6 = document.querySelector('input[name="resposta6"]:checked').value;
        const resposta7 = document.querySelector('input[name="resposta7"]:checked').value;
        const resposta8 = document.querySelector('input[name="resposta8"]:checked').value;
        const resposta9 = document.querySelector('input[name="resposta9"]:checked').value;
        const resposta10 = document.querySelector('input[name="resposta10"]:checked').value;

        console.log(resposta1, resposta2, resposta3, resposta4, resposta5, resposta6, resposta7, resposta8, resposta9, resposta10)
        calcularKPIs()

        fetch("/quiz/cadastrarRespostas", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                resposta1Server: resposta1,
                resposta2Server: resposta2,
                resposta3Server: resposta3,
                resposta4Server: resposta4,
                resposta5Server: resposta5,
                resposta6Server: resposta6,
                resposta7Server: resposta7,
                resposta8Server: resposta8,
                resposta9Server: resposta9,
                resposta10Server: resposta10
            }),
        })
            .then(function (resposta) {
                console.log("Resposta do servidor: ", resposta);

                if (resposta.ok) {
                    alert("Respostas enviadas com sucesso!");
                    calcularKPIs()
                    let redirecionarDash = "./dashboard/dashboard.html";
                    window.location.href = redirecionarDash;

                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (erro) {
                console.log(`#ERRO: ${erro}`);
                alert("Ocorreu um erro ao enviar as respostas. Por favor, tente novamente mais tarde.");
            });
        return false;



    }

    function calcularKPIs() {

        // Array contendo as respostas corretas para cada pergunta
        const respostasCorretas = ["Markus Persson", "Cave Game", "The End, The Nether, Overworld", "Enderman", "Enderdragon", "Obsidiana", "Creeper", "Pó de blaze", "Pico de Diamante com Toque de Seda", "8 blocos Nether equivalem a 64 blocoss no Overworld"];
        let pontuacaoTotal = 0;
        let respostasCorretasPlayer = 0;

        /*For que intera um valor para cada pergunta*/
        for (let contador = 0; contador <= 9; contador++) {

            let resposta = document.querySelector('input[name="resposta' + (contador + 1) + '"]:checked');
            // Verificar se uma resposta foi selecionada e em seguida pega o valor
            if (resposta) {
                resposta = resposta.value;

                if (resposta == respostasCorretas[contador]) {
                    pontuacaoTotal += 10;
                    respostasCorretasPlayer++;
                }
            }
        }

        console.log('Pontuação Total:' + pontuacaoTotal);
        console.log('Total de Acertos:' + respostasCorretasPlayer);

    }


</script>