<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="dashboard.css">
    <script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
</head>

<body onload="listar()">
    <section class="sectionsMenus">
        <div class="navigation">
            <ul>
                <li class="list active">
                    <a href="../index.html">
                        <span class="icon"><ion-icon name="home"></ion-icon></span>
                        <span class="title">Home</span>
                    </a>
                </li>
                <br>
                <!-- <li class="list">
                    <a href="./perfil/perfil.html" onclick="ativarPerfil()">
                        <span class="icon"><ion-icon name="person"></ion-icon></span>
                        <span class="title">Perfil</span>
                    </a>
                </li>
                <br> -->
                <li class="list">
                    <a href="./dashboard.html">
                        <span class="icon"><ion-icon name="analytics"></ion-icon></span>
                        <span class="title">Dashboard</span>
                    </a>
                </li>
                <br>
                <li class="list">
                    <a href="#">
                        <span class="icon"><ion-icon name="analytics"></ion-icon></span>
                        <span class="title">Ranking</span>
                    </a>
                </li>
                <br>
                <li class="list">
                    <a href="#">
                        <span class="icon"><ion-icon name="chatboxes"></ion-icon></span>
                        <span class="title">Anotações</span>
                    </a>
                </li>
                <br>
                <li class="list">
                    <a href="#">
                        <span class="icon"><ion-icon name="help-circle-outline"></ion-icon></span>
                        <span class="title">Help</span>
                    </a>
                </li>
                <br>
                <li class="list" style="margin-top: 150px;">
                    <a href="#">
                        <span class="icon"><ion-icon name="person"></ion-icon></span>
                        <span class="title">Sair</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="containerRef">

            <div class="container">
                <div class="cardKPIs">
                    <h1>Média Acertos por Usuários</h1>
                    <p id="totalAcertos"></p>
                    <div class="color-box"></div>
                </div>
                <div class="cardKPIs">
                    <h1>Desacertos</h1>
                    <p id="desacertos"></p>
                    <div class="color-box"></div>
                </div>

                <div class="cardKPIs">
                    <h1>Taxa de Aproveitamento</h1>
                    <p id="aproveitamento"></p>
                    <div class="color-box"></div>
                </div>
                <div class="cardKPIs">
                    <div class="divCor"></div>
                    <h1>KPI</h1>
                    <p id="totalPontos"></p>
                    <div class="color-box"></div>
                </div>

            </div>

            <div class="containerChartJs">
                <h2>Quiz Ranking</h2>
                <div id="tabelaRanking" class="tabela">
                    <div class="cabecalho" >
                        <div class="cabecalho-item">Posição</div>
                        <div class="cabecalho-item">Usuário</div>
                        <div class="cabecalho-item">Pontuação</div>
                        <div class="cabecalho-item">Tempo Total</div>
                    </div>
                    <div id="corpoTabela" class="corpo"></div>
                </div>
            

    </section>

</body>

</html>
<script>
const ranking = [];

    function listar() {
        fetch("/medidas/ranking", {
            method: "GET",
        })
            .then(function (resposta) {
                if (!resposta.ok) {
                    throw new Error('Erro ao recuperar o ranking');
                }
                return resposta.json();
            })
            .then((ranking) => {
                console.log('Dados do ranking recebidos com sucesso:', ranking);
                preencherRanking(ranking);


            })
            .catch(function (erro) {
                console.error(`#ERRO: ${erro.message}`);
            });
    }
// função para preencher o ranking
    function preencherRanking(ranking) {
//reordena do maior para o menor (sort() = ornagina os elementos do arraw conforme a função dada)
        ranking.sort((a, b) => b.pontuacao - a.pontuacao);

    const corpoTabela = document.getElementById('corpoTabela');
    corpoTabela.innerHTML = '';

//forEach() é usado para iterar sobre cada entrada no ranking ordenado
    ranking.forEach((resultado, indice) => {
        const valorLinha = document.createElement('div');
        valorLinha.classList.add('linha');
        valorLinha.innerHTML = `
            <div class="item">${indice + 1}º</div>
            <div class="item">${resultado.nome_usuario}</div>
            <div class="item">${resultado.pontuacao}</div>
            <div class="item">${resultado.tempo_gasto}</div>
        `;
        corpoTabela.innerHTML += valorLinha.outerHTML;
    });
}

    listar();
    setInterval(listar, 120000)

   
    function controleCoresBox() {
        
    }
    
    function exibirValoresKPIs() {
         

        console.log('Certas:', sessionStorage.RESPOSTA_CORRETA);
        console.log('Total:', sessionStorage.PONTUACAO_TOTAL);
        console.log('Erros:', sessionStorage.DESACERTOS)
        console.log('Aproveitamento:', sessionStorage.APROVEITAMENTO)

        totalAcertos.innerHTML = '<p style="display"><strong>' + sessionStorage.RESPOSTA_CORRETA + '<span style="font-size: 20px;"> questões</span></strong>';
        // totalPontos.innerHTML = '<strong>' + sessionStorage.PONTUACAO_TOTAL + '<span style="font-size: 20px;"> pontos</span></strong>';
        desacertos.innerHTML = '<strong>' + sessionStorage.DESACERTOS + '<span style="font-size: 20px;"> questões</span></strong>';
        aproveitamento.innerHTML = '<strong>' + sessionStorage.APROVEITAMENTO + '<span style="font-size: 28px;">%</span></strong>';



    }


    exibirValoresKPIs();


   
   


</script>